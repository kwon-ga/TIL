## ✔ 프로세스란 ?

<br>

✅ 프로세스란 ?

<br>

프로세스는 일반적으로 실행중인 프로그램으로 정의된다.

프로그램은 디스크 상에 존재하며 실행을 위한 명령어와 정적인 데이터의 묶음이다.

이러한 명령어와 데이터의 묶음을 읽고 실행하여 프로그램에 생명을 넣어주는 역할을 하는 것이 운영체제이다.

프로세스의 하드웨어 상태 중 가장 중요한 구성 요소는 메모리이다.

멍령어와 프로그램이 읽고 쓰는 데이터는 메모리에 저장된다.

레지스터 또한 프로세스의 하드웨어 상태를 구성하는 요소 중 하나이다.

<br>

✅ 레지스터란 ?

<br>

CPU가 프로세스를 처리하는데 필요한 정보를 일시적으로 기억하는 저장장치이다.

레지스터의 주요 기능은 PC(Program Counter) SP(Stack Pointer)이다.

PC는 코드를 한 줄 한 줄 가리키는 주소 레지스터를 의미하며,

SP는 코드의 함수가 실행될 때 스택 프레임의 최상단 주소를 가리키는 레지스터이다.

이 두 가지는 프로세스가 컨텍스트 스위칭을 하는 등의 중요한 역할을 하도록 도와준다.

여기서 컨텍스트 스위칭이란 스케줄러에 의해 프로세스가 전환되는 메커니즘을 칭한다.

<br>

✅ 프로세스란 2 

<br>

많은 명령어들이 레지스터를 직접 읽거나 갱신한다. 

프로그램 실행을 위하여 운영체제가 하는 첫 번째 작업은 프로그램의 코드와 정적 데이터를 메모리, 프로세스의 주소 공간에 탑재하는 것이다.

다음으로 운영체제는 프로그램의 스택과 힙을 위한 메모리 영역을 할당한다.

추가적인 작업을 마친 뒤 운영체제는 CUP를 새로 생성된 프로세스에게 넘기게 되고 프로그램 실행이 시작된다.

프로세스는 기본적으로 다음과 같은 단계가 있다.

실행 :  
실행 상태에서 프로세스는 실행중인 것을 의미한다. 즉 명령어를 실행 한다는 의미와 같다.

준비 :  
준비 상태에서 프로세스는 실행할 준비가 되어있지만 운영체제가 다른 프로세스를 실행하고 있는 등의 이유로 대기중인 상태를 의미한다.

대기 :  
프로세스가 다른 작업을 기다리는 동안 프로세스의 수행을 중단시키는 연산을 의미한다.

-> 프로세스가 디스크에 대한 입출력을 요청하는 경우 프로세스는 입출력이 완료될 때까지 대기 상태가 되고 다른 프로세스를 실행 상태로 돌리며 입출력이 끝난 후에 다시 실행 상태로 바뀌게 된다.

더욱 세분화된 상태도 있으나 기본적인 상태만 알고가기로 한다.

<br>

✅ 프로세스의 구성

<br>

프로세스는 크게 텍스트, 데이터, 스택, 힙이라는 네 영역으로 구분할 수 있다.

TEXT :  
CPU에서 직접 수행되는 명령어를 가진다. Code 영역이라고 하며, 코드 자체를 구성하는 메모리 영역으로 Hex 파일이나 Bin 파일 메모리이다.

DATA :  
전역 변수가 이곳에 속한다. 그 외에 프로그램이 실행될 때 생성되고 프로그램이 종료되면 시스템에 반환되며 정적 변수 , 배열 등이 저장되는 곳이다.

HEAP :  
동적으로 할당 받는 내용을 가진다. 동적 데이터의 영역이라고 부르기도 한다. 메모리 주소 값에 의해 참조되고 사용되는 영역이다.

STACK :  
지역 변수와 인자, 그리고 함수 리턴 주소를 가진다. 함수 호출 시에 생성되고, 함수가 끝나면 반환된다.  

<br>

PCB (Process Control Block)

운영체제가 프로세스를 제어하기 위해 정보를 저장해 놓은 곳으로 프로세스의 상태 정보를 저장하는 메모리의 별도 공간이다.

이것은 프로세스 상태 관리와 컨텍스트 스위칭을 위해 필요하다.

PCB 구성 요소

PID : 프로세스 고유의 번호를 의미한다.  
State : 준비, 대기, 실행 등의 상태를 의미한다.  
포인터 : 다름에 실행될 프로세스의 포인터를 의미한다.  
Register save area : 레지스터 관련 정보이다.  
Priority : 스케쥴링 및 프로세스의 우선순위와 할당된 자원 정보도 포함하고 있다.  
Account : CPU 사용 시간, 실제 사용된 시간도 포함한다. 입출력 상태 정보를 포함한다.



<br>

✅ 컨텍스트 스위칭

<br>

여러개의 프로세스가 실행되도 있는 경우 기존에 실행되던 프로세스를 중단하고 다른 프로세스를 실행하는 것.  
즉, CPU에 실행할 프로세스를 교체하는 방법이다.

컨텍스트 스위칭은 PCB에 프로세스 상태를 저장하고 해당 값들을 찾는 방법으로 구현된다.

컨텍스트 스위칭 예시  
A 프로세스 : 실행상태  
B 프로세스 : 준비상태  

1.스케쥴러가 A 프로세스의 실행을 중단하고 B 프로세스의 실행을 요청한다.

2.A 프로세스에서 Stack의 데이터 위치를 가리키고 있는 SP의 값과 다음 실행해야하는 코드의 주소 값을 가지고 있는 PC의 값을 PCB에 저장한다.  

3.A 프로세스는 ready 혹은 block 상태로 바뀌고, CPU에서 B 프로세스를 실행한다.  
이 과정을 통해 B 프로세스 상태가 ready에서 running으로 바뀐다.

4.반대로 다시 B프로세스에서 A프로세스로 컨텍스트 스위칭 할 경우, B 프로세스의 SP 값과 PC 값을 PCB에 저장하고 A 프로세스의 PCB에서 SP 값과 CP 값을 찾아 SP / PC에 덮어 씌운다.

컨텍스트 스위칭은 짧은 시간 단위로 일어나지만 과도하게 많이 일어날 경우 오버헤드가 발생하게 된다.

https://pages.cs.wisc.edu/~remzi/OSTEP/
https://iredays.tistory.com/118